% create spectral structures,
% SpectralStructure_SEMPNTB_AXF0647_AXF0660_AXF0680_AXF0700.mat
% SpectralStructure_SEMPNTB_FSB0515_FSB0580_FSB0680.mat
% SpectralStructure_SEMPNTB_SJF0549_AXF0647.mat
% SpectralStructure_SEMPNTB_SKYLANS_SJF0549_AXF0647.mat

clc
clear

PNTBDCRFileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/PNTBDCR.csv';
PNTBTRNFileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/PNTBTRN.csv';
skylan_sFileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/skylan_s.csv';

PNTBDCR = readmatrix(PNTBDCRFileName);
PNTBTRN = readmatrix(PNTBTRNFileName);

PNTBDCRtemp=zeros(700,2);
PNTBTRNtemp=zeros(700,2);
count = 0;
for ii=1:size(PNTBDCR,1)
    if (PNTBDCR(ii,1)==floor(PNTBDCR(ii,1)))
        count = count+1;
        PNTBDCRtemp(count,1)=PNTBDCR(ii,1);
        PNTBDCRtemp(count,2)=PNTBDCR(ii,2);
        PNTBTRNtemp(count,1)=PNTBTRN(ii,1);
        PNTBTRNtemp(count,2)=PNTBTRN(ii,2);
    end
end

PNTBDCR=PNTBDCRtemp./max(PNTBDCRtemp);
PNTBTRN=PNTBTRNtemp./max(PNTBTRNtemp);
SEMPNTB=zeros(size(PNTBDCR)); % the net transmission including both the dichroic and filter
SEMPNTB(:,1)=PNTBDCR(:,1);
SEMPNTB(:,2)=PNTBDCR(:,2).*PNTBTRN(:,2);
SEMPNTB(:,2)=SEMPNTB(:,2)./max(SEMPNTB(:,2));
skylan_s = readmatrix(skylan_sFileName);
size(PNTBDCR)
size(PNTBTRN)
size(skylan_s)

figure(1)
plot(PNTBDCR(:,1),PNTBDCR(:,2)), hold on;
plot(PNTBTRN(:,1),PNTBTRN(:,2)),
plot(SEMPNTB(:,1),SEMPNTB(:,2))
hold off

SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700FileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.mat';
SpectralStructure_BRUVUT_SJF0549_AXF0647FileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_BRUVUT_SJF0549_AXF0647.mat';
SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680FileName='/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.mat';

SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700 = load(SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700FileName);
SpectralStructure_BRUVUT_SJF0549_AXF0647 = load(SpectralStructure_BRUVUT_SJF0549_AXF0647FileName);
fnames=fieldnames(SpectralStructure_BRUVUT_SJF0549_AXF0647);
for ii=1:numel(fnames)
    SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Wavelength=...
        cat(1,linspace(0.3,0.399,100)',...
        SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Wavelength,...
        linspace(0.801,0.999,199)');
    SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Filter=...
        cat(1,zeros(100,1),...
        SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Filter,...
        zeros(199,1));
    SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Spectrum=...
        cat(1,zeros(100,1),...
        SpectralStructure_BRUVUT_SJF0549_AXF0647.(fnames{ii}).Spectrum,...
        zeros(199,1));
end
SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680 = load(SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680FileName);

%%

SpectralStructure_SEMPNTB_AXF0647_AXF0660_AXF0680_AXF0700=...
    struct('AXF0647',...
        struct('Wavelength',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0647.Wavelength,...
               'Spectrum',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0647.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'AXF0660',...
        struct('Wavelength',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0660.Wavelength,...
               'Spectrum',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0660.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'AXF0680',...
        struct('Wavelength',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0680.Wavelength,...
               'Spectrum',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0680.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'AXF0700',...
        struct('Wavelength',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0700.Wavelength,...
               'Spectrum',SpectralStructure_AXF0647_AXF0660_AXF0680_AXF0700.AXF0700.Spectrum,...
               'Filter',SEMPNTB(:,2)));
figure(1)
SS=SpectralStructure_SEMPNTB_AXF0647_AXF0660_AXF0680_AXF0700;
fnames=fieldnames(SS);
for ii=1:numel(fnames)
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Spectrum),
    hold on;
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Filter);
end
hold off
      

SpectralStructure_SEMPNTB_FSB0515_FSB0580_FSB0680=...
    struct('FSB0515',...
        struct('Wavelength',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0515.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0515.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'FSB0580',...
        struct('Wavelength',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0580.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0580.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'FSB0680',...
        struct('Wavelength',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0680.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_FSB0515_FSB0580_FSB0680.FSB0680.Spectrum,...
               'Filter',SEMPNTB(:,2)));
figure(2)
SS=SpectralStructure_SEMPNTB_FSB0515_FSB0580_FSB0680;
fnames=fieldnames(SS);
for ii=1:numel(fnames)
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Spectrum),
    hold on;
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Filter);
end
hold off

SpectralStructure_SEMPNTB_SJF0549_AXF0647=...
    struct('SJF0549',...
        struct('Wavelength',SpectralStructure_BRUVUT_SJF0549_AXF0647.SJF0549.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_SJF0549_AXF0647.SJF0549.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'AXF0647',...
        struct('Wavelength',SpectralStructure_BRUVUT_SJF0549_AXF0647.AXF0647.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_SJF0549_AXF0647.AXF0647.Spectrum,...
               'Filter',SEMPNTB(:,2)));
figure(3)
SS=SpectralStructure_SEMPNTB_SJF0549_AXF0647;
fnames=fieldnames(SS);
for ii=1:numel(fnames)
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Spectrum),
    hold on;
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Filter);
end
hold off

SpectralStructure_SEMPNTB_SKYLANS_SJF0549_AXF0647=...
    struct('SKYLANS',...
        struct('Wavelength',skylan_s(:,1),...
               'Spectrum',skylan_s(:,3),...
               'Filter',SEMPNTB(:,2)),...
           'SJF0549',...
        struct('Wavelength',SpectralStructure_BRUVUT_SJF0549_AXF0647.SJF0549.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_SJF0549_AXF0647.SJF0549.Spectrum,...
               'Filter',SEMPNTB(:,2)),...
           'AXF0647',...
        struct('Wavelength',SpectralStructure_BRUVUT_SJF0549_AXF0647.AXF0647.Wavelength,...
               'Spectrum',SpectralStructure_BRUVUT_SJF0549_AXF0647.AXF0647.Spectrum,...
               'Filter',SEMPNTB(:,2)));
figure(4)
SS=SpectralStructure_SEMPNTB_SKYLANS_SJF0549_AXF0647;
fnames=fieldnames(SS);
for ii=1:numel(fnames)
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Spectrum),
    hold on;
    plot(SS.(fnames{ii}).Wavelength,SS.(fnames{ii}).Filter);
end
hold off

save('/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_SEMPNTB_AXF0647_AXF0660_AXF0680_AXF0700.mat',...
    '-struct','SpectralStructure_SEMPNTB_AXF0647_AXF0660_AXF0680_AXF0700');

save('/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_SEMPNTB_FSB0515_FSB0580_FSB0680.mat',...
    '-struct','SpectralStructure_SEMPNTB_FSB0515_FSB0580_FSB0680');

save('/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_SEMPNTB_SJF0549_AXF0647.mat',...
    '-struct','SpectralStructure_SEMPNTB_SJF0549_AXF0647');

save('/media/strgA/July2019LiveCellImaging_exported_tiffs/SpectralStructure_SEMPNTB_SKYLANS_SJF0549_AXF0647.mat',...
    '-struct','SpectralStructure_SEMPNTB_SKYLANS_SJF0549_AXF0647');